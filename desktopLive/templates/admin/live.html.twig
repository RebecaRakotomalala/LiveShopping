{% extends 'base.html.twig' %}

{% block title %}Live - Admin{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h1 class="mb-4">ðŸŽ¬ Diffusion en direct</h1>

        {% if live %}
            <p><strong>DÃ©but du live :</strong> {{ live.startLive|date('Y-m-d H:i') }}</p>

            <video id="webcamPreview" autoplay muted width="100%" class="mb-3"></video>

            <a href="{{ path('admin_live_stop', {'id': live.id}) }}" class="btn btn-danger">
                â›” Terminer le Live
            </a>
        {% else %}
            <p>Aucun live nâ€™est en cours pour le moment.</p>
            <a href="{{ path('admin_live_start') }}" class="btn btn-success">
                ðŸŽ¥ DÃ©marrer un Live
            </a>
        {% endif %}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {% if live %}
        <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const webcam = document.getElementById("webcamPreview");

                // Demande l'accÃ¨s Ã  la camÃ©ra et au micro
                navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                    .then(function (stream) {
                        webcam.srcObject = stream;

                        // ðŸ’¡ Ici tu pourrais envoyer `stream` Ã  ton serveur WebSocket ou Media Server si tu veux diffuser en live
                    })
                    .catch(function (err) {
                        console.error("Erreur dâ€™accÃ¨s Ã  la camÃ©ra :", err);
                        alert("Impossible dâ€™accÃ©der Ã  la camÃ©ra : " + err.message);
                    });
            });
        </script>
    {% endif %}
{% endblock %}
